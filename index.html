<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>webSocket在线</title>
    <meta content="webSocket在线, socket在线, socket测试工具, webSocket" name="description">
    <meta content="webSocket在线, Socket在线, socket测试工具 webSocket" name="keywords">
    <link type="text/css" rel="stylesheet" href="css/base.css">
</head>
<body id="app">
<!--顶部组件-->
<div class="header">
    <div class="header_logo inline-block">WebSocket</div>
    <div class="header_em inline-block">在线测试 <i>(v 1.0.0)</i></div>
    <div class="header_menu"></div>
    <div class="header_user"></div>
</div>
<!--中间组件-->
<div class="middle">
    <div class="middle_left inline-block">
        <div class="input_group">
            <label class="inline-block" for="">测试地址</label>
            <input class="inline-block" id="url" value="ws://http://47.103.201.207:3000" type="text" placeholder="ws://">
            <button class="inline-block" id="connection">连接</button>
            <button class="inline-block" id="disconnect">断开</button>
        </div>

        <div class="messageList">
            <p class="title">消息 <span id="connectionInfo"></span></p>
            <ul class="messageInfo" id="messageInfo">
<!--<li class="message self">-->
<!--<span>测试地址</span> <span> <i> : (10:10:00) </i> 我</span>-->
<!--</li>-->

<!--<li class="message services">-->
<!--<span>测试地址 <i>(10:10:00) :</i></span> <span> 服务器</span>-->
<!--</li>                -->

            </ul>
        </div>
        <div class="sendInfo">
            <textarea name="sendValue" id="sendValue" cols="30" rows="10"></textarea>
            <p><button class="none">定时发送</button> <button id="send">发送</button></p>
        </div>
    </div>
<!--    <div class="middle_right inline-block">-->
<!--        <ul>-->
<!--            <li><a href="javascript:void(0)">vue+websocket(原生)使用方法AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</a></li>-->
<!--            <li><a href="javascript:void(0)">vue+websocket详解精简篇（一）</a></li>-->
<!--        </ul>-->
<!--    </div>-->
    <div class="clear"></div>
</div>
<!--底部组件-->
<div class="footer">

</div>
</body>
<script type="text/javascript">
    // window.onload = function () {
    //     document.querySelector('#app').style.zoom = window.innerWidth / 1920;
    // }

    let connectionBtn = document.getElementById('connection');
    let disconnectBtn = document.getElementById('disconnect');
    let sendBtn = document.getElementById('send');
    let ws = null;
    let connectionInfo = document.getElementById('connectionInfo');
    let messageInfoDom = document.getElementById('messageInfo');

    connectionBtn.addEventListener('click', function () {
        let value = document.getElementById("url").value;
        if ('WebSocket' in window) {
            ws = new WebSocket(value);
            ws.onopen = function () {
                connectionInfo.innerHTML = '连接成功'
                connectionInfo.style.color = 'green'
            }

        } else {
            connectionInfo.innerHTML = '你的浏览器不支持websocket'
            connectionInfo.style.color = 'red'
        }
    }, false)


    // 我发送的信息
    function install_self (data){
        let liDom = document.createElement('li');
        let spanDom_key = document.createElement('span');
        let spanDom_val = document.createElement('span');
        let _iDom = document.createElement('i');
        let iDom_ = document.createElement('i');
        spanDom_val.innerHTML = ''+data.value+' : '
        _iDom.innerText = '('+data.time+')'
        iDom_.innerHTML = '我'
        liDom.className = 'message self';
        liDom. appendChild(spanDom_val);
        liDom. appendChild(spanDom_key);
        spanDom_key. appendChild(_iDom);
        spanDom_key. appendChild(iDom_);
        messageInfoDom. appendChild(liDom);
    }
    // 返回消息
    function install_services (data){
        let messageInfoDom = document.getElementById('messageInfo');
        let liDom = document.createElement('li');
        let spanDom_key = document.createElement('span');
        let spanDom_val = document.createElement('span');
        let _iDom = document.createElement('i');
        let iDom_ = document.createElement('i');
        spanDom_val.innerHTML = ' : '+data.value+''

        _iDom.innerText = '('+data.time+')'
        iDom_.innerHTML = '服务器'
        liDom.className = 'message services';
        liDom. appendChild(spanDom_key);
        liDom. appendChild(spanDom_val);
        spanDom_key. appendChild(iDom_);
        spanDom_key. appendChild(_iDom);
        messageInfoDom. appendChild(liDom);
    }
    // 发送
    sendBtn.addEventListener('click', function () {
        connectionInfo.innerHTML = ''
        let sendValue = document.getElementById('sendValue').value;
        let data = {time: getDate(), value: sendValue}
        if(ws && ws.readyState == 1){
            if(sendValue.length>0){
                ws.send(sendValue)
                install_self(data)
                ws.onmessage = function (event) {
                    console.log(event)
                    let data = {time: getDate(), value: event.data}
                    install_services(data)
                }
            } else {
                connectionInfo.innerHTML = '检测到您内容为空'
                connectionInfo.style.color = 'red'
            }
        } else {
            connectionInfo.innerHTML = '尚未建立连接'
            connectionInfo.style.color = 'red'
        }

        messageInfoDom.scrollTop = messageInfoDom.scrollHeight;
    }, false)
    // 断开连接
    disconnectBtn.addEventListener('click', function () {
        ws.close();
        connectionInfo.innerHTML = '连接已经关闭'
        connectionInfo.style.color = 'red'
    }, false)
    // 获取当前时间
    function getDate() {

        let now = new Date();
        let year = now.getFullYear();
        let month = now.getMonth()+1;
        let date = now.getDate();
        let day = now.getDay();//得到周几
        let hour = now.getHours();//得到小时
        let minu = now.getMinutes();//得到分钟
        let sec = now.getSeconds();//得到秒

        return hour+":"+minu+":"+sec
    }
    // 时间戳转换为时间

    function formatDate(number) {
        let n = number * 1000;
        let date = new Date(n);
        let Y = date.getFullYear() + '-';
        let M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
        let D = date.getDate() < 10 ? '0' + date.getDate() : date.getDate();
        let h = date.getHours() + ':';
        let m = date.getMinutes() + ':';
        let s = date.getSeconds();
        return (Y + M + D + " " + h + m + s);
    }
</script>
</html>